<!DOCTYPE html>
<html lang="en">
  <head><!-- Prefetch -->
<link rel="dns-prefetch" href="https://fonts.gstatic.com/" >
<link rel="dns-prefetch" href="https://cdn.jsdelivr.net/" >
<link rel="dns-prefetch" href="https://cdnjs.cloudflare.com/" >

<!-- Meta -->
<meta charset="utf-8" />
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no, minimum-scale=1, maximum-scale=5">

<meta name="HandheldFriendly" content="True">
<meta name="MobileOptimized" content="320">

<link rel="canonical" href="https://music.soundgrail.com/authentication/token/"><meta name="robots" content="noindex">
<!-- Manifest.json -->
<link rel="manifest" href="https://music.soundgrail.com/manifest.json">

<!-- Title --><title>SoundGrail - Token</title>
<meta name="twitter:title" content="SoundGrail - Token" />
<meta property="og:title" content="SoundGrail - Token" />

<!-- Description --><meta name="description" content="Token SoundGrail.">
<meta name="twitter:description" content="Token SoundGrail." />
<meta property="og:description" content="Token SoundGrail." />

<!-- Image --><meta name="twitter:image" content="https://cdn.itwcreativeworks.com/assets/soundgrail/images/logo/soundgrail-brandmark-black-3000x3000.png" />
<meta property="og:image" content="https://cdn.itwcreativeworks.com/assets/soundgrail/images/logo/soundgrail-brandmark-black-3000x3000.png" />

<!-- OG: Twitter -->
<meta name="twitter:card" content="summary" />
<meta name="twitter:site" content="soundgrailmusic" />
<meta name="twitter:widgets:theme" content="light">

<!-- OG: Facebook / Open Graph -->
<meta property="og:url" content="https://music.soundgrail.com/authentication/token/" />
<meta property="og:type" content="article" />

<!-- Main Feed -->
<link href="https://music.soundgrail.com/feed.xml" type="application/atom+xml" rel="alternate" title="SoundGrail Feed">


<!-- Configuration -->
<script type="text/javascript">
  

  var Configuration = {
    page: {
      code: 'Token',
      type: 'general',
      breadcrumb: 'Token',
      settings:  { libraries: { cookieconsent: { enabled: false }, tawk: { enabled: false }, lazysizes: { enabled: false, }, } } 
    },
    global: {
      app: 'soundgrail',
      version: '1.0.0',
      url: 'https://music.soundgrail.com',
      cacheBreaker: '1659317455',
      settings:  { libraries: { firebase_app: { enabled: true, config: { apiKey: 'AIzaSyCeZVDmipvFDY1qutqEmjnfUlgtEXBArxA', authDomain: 'soundgrail-app.firebaseapp.com', databaseURL: 'https://soundgrail-app.firebaseio.com', projectId: 'soundgrail-app', storageBucket: 'soundgrail-app.appspot.com', messagingSenderId: '1032985509697', appId: '1:1032985509697:web:16f02ddd81668a40d6abc0', measurementId: '' } }, cookieconsent: { enabled: true, config: { palette: { popup: { _background: '#FA96BE', background: '#377dff', }, } } }, tawk: { enabled: true, config: { chatId: '619743a56bb0760a494352f5', widgetId: '1fkre0gd5', _prechatColor: '#FA96BE', prechatColor: '#377dff', } }, sentry: { enabled: true, config: { dsn: '', release: 'soundgrail-website-app' } } } } ,
      brand: {
        name: 'SoundGrail'
      },
      contact: {
        emailSupport: 'support@soundgrail.com',
        emailBusiness: 'support@soundgrail.com'
      },
      // tracking: {
      //   googleAnalytics: 'UA-114924895-3',
      //   facebookPixel: 'false',
      //   tikTokPixel: 'false'
      // }
    }
  };
</script>

<!-- Redirect --><!-- Favicon --><link rel="apple-touch-icon" sizes="180x180" href="https://cdn.itwcreativeworks.com/assets/soundgrail/images/favicon/apple-touch-icon.png?cb=1659317455">
<link rel="icon" type="image/png" sizes="32x32" href="https://cdn.itwcreativeworks.com/assets/soundgrail/images/favicon/favicon-32x32.png?cb=1659317455">
<link rel="icon" type="image/png" sizes="16x16" href="https://cdn.itwcreativeworks.com/assets/soundgrail/images/favicon/favicon-16x16.png?cb=1659317455">
<link rel="mask-icon" href="https://cdn.itwcreativeworks.com/assets/soundgrail/images/favicon/safari-pinned-tab.svg" color="#5bbad5">
<link rel="shortcut icon" href="https://cdn.itwcreativeworks.com/assets/soundgrail/images/favicon/favicon.ico?cb=1659317455">
<meta name="msapplication-TileColor" content="#da532c">
<meta name="msapplication-config" content="https://cdn.itwcreativeworks.com/assets/soundgrail/images/favicon/browserconfig.xml?cb=1659317455">
<meta name="theme-color" content="#ffffff">

<!-- CSS - Defaults-->
<style type="text/css" media="screen">
  
  
  /*! defaults.css v1.0.0 | MIT License | ITW Creative Works */
@font-face {
  font-display: auto;
}

.hidden {
  display: none;
}

article, aside, details, figcaption, figure,
footer, header, hgroup, menu, nav, section {
  display: block;
}

  

  .cc-window{opacity:1;transition:opacity 1s ease}.cc-window.cc-invisible{opacity:0}.cc-animate.cc-revoke{transition:transform 1s ease}.cc-animate.cc-revoke.cc-top{transform:translateY(-2em)}.cc-animate.cc-revoke.cc-bottom{transform:translateY(2em)}.cc-animate.cc-revoke.cc-active.cc-bottom,.cc-animate.cc-revoke.cc-active.cc-top,.cc-revoke:hover{transform:translateY(0)}.cc-grower{max-height:0;overflow:hidden;transition:max-height 1s}
.cc-link,.cc-revoke:hover{text-decoration:underline}.cc-revoke,.cc-window{position:fixed;overflow:hidden;box-sizing:border-box;font-family:Helvetica,Calibri,Arial,sans-serif;font-size:16px;line-height:1.5em;display:-ms-flexbox;display:flex;-ms-flex-wrap:nowrap;flex-wrap:nowrap;z-index:9999}.cc-window.cc-static{position:static}.cc-window.cc-floating{padding:2em;max-width:24em;-ms-flex-direction:column;flex-direction:column}.cc-window.cc-banner{padding:1em 1.8em;width:100%;-ms-flex-direction:row;flex-direction:row}.cc-revoke{padding:.5em}.cc-header{font-size:18px;font-weight:700}.cc-btn,.cc-close,.cc-link,.cc-revoke{cursor:pointer}.cc-link{opacity:.8;display:inline-block;padding:.2em}.cc-link:hover{opacity:1}.cc-link:active,.cc-link:visited{color:initial}.cc-btn{display:block;padding:.4em .8em;font-size:.9em;font-weight:700;border-width:2px;border-style:solid;text-align:center;white-space:nowrap}.cc-highlight .cc-btn:first-child{background-color:transparent;border-color:transparent}.cc-highlight .cc-btn:first-child:focus,.cc-highlight .cc-btn:first-child:hover{background-color:transparent;text-decoration:underline}.cc-close{display:block;position:absolute;top:.5em;right:.5em;font-size:1.6em;opacity:.9;line-height:.75}.cc-close:focus,.cc-close:hover{opacity:1}
.cc-revoke.cc-top{top:0;left:3em;border-bottom-left-radius:.5em;border-bottom-right-radius:.5em}.cc-revoke.cc-bottom{bottom:0;left:3em;border-top-left-radius:.5em;border-top-right-radius:.5em}.cc-revoke.cc-left{left:3em;right:unset}.cc-revoke.cc-right{right:3em;left:unset}.cc-top{top:1em}.cc-left{left:1em}.cc-right{right:1em}.cc-bottom{bottom:1em}.cc-floating>.cc-link{margin-bottom:1em}.cc-floating .cc-message{display:block;margin-bottom:1em}.cc-window.cc-floating .cc-compliance{-ms-flex:1 0 auto;flex:1 0 auto}.cc-window.cc-banner{-ms-flex-align:center;align-items:center}.cc-banner.cc-top{left:0;right:0;top:0}.cc-banner.cc-bottom{left:0;right:0;bottom:0}.cc-banner .cc-message{display:block;-ms-flex:1 1 auto;flex:1 1 auto;max-width:100%;margin-right:1em}.cc-compliance{display:-ms-flexbox;display:flex;-ms-flex-align:center;align-items:center;-ms-flex-line-pack:justify;align-content:space-between}.cc-floating .cc-compliance>.cc-btn{-ms-flex:1;flex:1}.cc-btn+.cc-btn{margin-left:.5em}
@media print{.cc-revoke,.cc-window{display:none}}@media screen and (max-width:900px){.cc-btn{white-space:normal}}@media screen and (max-width:414px) and (orientation:portrait),screen and (max-width:736px) and (orientation:landscape){.cc-window.cc-top{top:0}.cc-window.cc-bottom{bottom:0}.cc-window.cc-banner,.cc-window.cc-floating,.cc-window.cc-left,.cc-window.cc-right{left:0;right:0}.cc-window.cc-banner{-ms-flex-direction:column;flex-direction:column}.cc-window.cc-banner .cc-compliance{-ms-flex:1 1 auto;flex:1 1 auto}.cc-window.cc-floating{max-width:none}.cc-window .cc-message{margin-bottom:1em}.cc-window.cc-banner{-ms-flex-align:unset;align-items:unset}.cc-window.cc-banner .cc-message{margin-right:0}}
.cc-floating.cc-theme-classic{padding:1.2em;border-radius:5px}.cc-floating.cc-type-info.cc-theme-classic .cc-compliance{text-align:center;display:inline;-ms-flex:none;flex:none}.cc-theme-classic .cc-btn{border-radius:5px}.cc-theme-classic .cc-btn:last-child{min-width:140px}.cc-floating.cc-type-info.cc-theme-classic .cc-btn{display:inline-block}
.cc-theme-edgeless.cc-window{padding:0}.cc-floating.cc-theme-edgeless .cc-message{margin:2em 2em 1.5em}.cc-banner.cc-theme-edgeless .cc-btn{margin:0;padding:.8em 1.8em;height:100%}.cc-banner.cc-theme-edgeless .cc-message{margin-left:1em}.cc-floating.cc-theme-edgeless .cc-btn+.cc-btn{margin-left:0}

</style>

<!-- CSS - Social Share Kit Style -->


<!-- App - Head Content (pre-bundle) -->
  <!-- App Head Content (pre-bundle) -->


<!-- CSS - Bundle-->
 <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap" rel="stylesheet">
<!-- CSS Implementing Plugins --> <link rel="stylesheet" href="https://cdn.itwcreativeworks.com/assets/ultimate-jekyll/vendor/front-admin/v2/vendor/bootstrap-icons/font/bootstrap-icons.css">
<!-- CSS Front Template -->
<link rel="stylesheet" href="https://cdn.itwcreativeworks.com/assets/ultimate-jekyll/vendor/front-admin/v2/css/theme.min.css" data-hs-appearance="default"> <link rel="preload" href="https://cdn.itwcreativeworks.com/assets/ultimate-jekyll/vendor/front-admin/v2/css/theme-dark.min.css" data-hs-appearance="dark" as="style">
<style data-hs-appearance-onload-styles> * { transition: unset !important; }
body { // opacity: 0; } </style> <style media="screen"> .auth-signin-provider-btn * { pointer-events: none; } </style> 


<!-- HTML5 Shiv -->
  <!--[if lt IE 9]>
  	<script src="https://cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7.3/html5shiv.min.js"></script>
  <![endif]-->


<!-- Initialize Manager -->
<script type="text/javascript">
  // Performance
  try {
    window.performance.mark('manager_start');
  } catch (e) {}

  function Manager$() {
    this.properties = {};
  };

  Manager$.prototype.ready = function(fn, options) {
    options = options || {};

    setTimeout(function () {
      Manager.auth().ready(fn, options);
    }, options.interval || 100);
  }

  Manager$.prototype.auth = function() {
    return {
      ready: function (fn, options) {
        options = options || {};

        setTimeout(function () {
          Manager.auth().ready(fn, options);
        }, options.interval || 100);

      }
    }
  }

  // Initialize globals
  var Manager = new Manager$();
  // var firebase;
  var Libraries = {
    // app: undefined,
    // lazysizes: undefined,
    // cookieconsent: undefined,
  };

</script>

<!-- Master - Styles -->
<style media="screen">
  /* Alert box */
  .master-alert {
    padding: 20px;
    background-color: #f44336;
    color: white;
    bottom:0;
    left:0;
    position:fixed;
    z-index:9999;
    width: 100%;
  }

  .master-alert a {
    color: white;
    text-decoration: underline;
  }
  .master-alert a:hover {
    color: black;
  }

  .master-alert-close {
    margin-left: 15px;
    color: white;
    font-weight: bold;
    float: right;
    font-size: 22px;
    line-height: 20px;
    cursor: pointer;
    transition: 0.3s;
  }

  .master-alert-close:hover {
    color: black;
  }

  .master-alert-outdated {
    display: none;
  }

  /* Chat box opener */
  #prechat-btn {
    position: fixed;
    background: #237AFC;
    color: #fff;
    width: 60px;
    height: 60px;
    text-align: center;
    line-height: 1;
    border-radius: 50%;
    right: 20px;
    bottom: 20px;
    transition: background 0.5s;
    z-index: 11;
    box-shadow: rgba(0, 0, 0, 0.16) 0px 2px 10px 0px;
  }

  #prechat-btn svg {
    padding-top: 25%;
    color: #fff;
    width: 50%;
    opacity: 1.0;
    pointer-events: none;
  }
  #prechat-btn:hover {
    opacity: 0.9;
  }

  @media (max-width: 768px) {
    #prechat-btn {
      bottom: 15px;
    }
  }
</style>

<!-- Style - IE 8 and Below Only -->
<!--[if lte IE 8]>
<link rel="stylesheet" type="text/css" href="/assets/css/master/lte-ie8.css?cb=1659317455">
<![endif]-->


<!-- App - Head Content -->


<!-- Page - Injected head -->


</head>

  <body class=" ">
    

    <!-- CONTENT START -->
    







<main id="content" role="main" class="main">
  <div class="position-fixed top-0 end-0 start-0 bg-img-start" style="height: 32rem; background-image: url(./assets/svg/components/card-6.svg);">
    <!-- Shape -->
    <div class="shape shape-bottom zi-1">
      <svg preserveAspectRatio="none" xmlns="http://www.w3.org/2000/svg" x="0px" y="0px" viewBox="0 0 1921 273">
        <polygon fill="#fff" points="0,273 1921,273 1921,0 " />
      </svg>
    </div>
    <!-- End Shape -->
  </div>

  <!-- Content -->
  <div class="container py-5 py-sm-7">
    <a class="d-flex justify-content-center mb-5" href="https://music.soundgrail.com" target="_blank">
      <img class="zi-2" id="main-logo" src="https://cdn.itwcreativeworks.com/assets/soundgrail/images/logo/soundgrail-brandmark-black-x.svg?cb=1659317455" alt="SoundGrail" style="width: 8rem;">
    </a>

    <div class="mx-auto" style="max-width: 30rem;">
      <!-- Card -->
      <div class="card card-lg mb-5">
        <div class="card-body">

          <div class="d-flex justify-content-center">
            <div id="spinner" class="spinner-border text-primary mb-3" role="status"></div>
          </div>

          <div class="d-grid">
            <div id="" class="alert alert-danger auth-error-message-element" role="alert" hidden> </div>
            <div id="result" class="alert" role="alert" hidden> </div>
            <a id="relaunch-btn" href="#" class="btn btn-primary" hidden>Resend credentials to the SoundGrail app</a>
          </div>

          <div id="auth-container" hidden>
            <!-- Form --><div>
              <div class="text-center">
                <div class="mb-5">
                  <h1 class="display-5">Account required</h1>
                  An account is required for <strong>SoundGrail</strong>
                </div>
              </div><div class="d-grid gap-2 mb-4">
                  <a id="" class="btn btn-primary" href="https://music.soundgrail.com/authentication/signup">Sign up for an account</a>
                </div>
                <div class="text-center">
                  <span class="divider-center text-muted mb-4">OR</span>
                  <div class="">
                    <p>Already have an account? <a class="link" href="https://music.soundgrail.com/authentication/signin">Sign in</a></p>
                  </div>
                </div></div></div>

          <!-- End Form -->
        </div>
      </div>
      <!-- End Card -->

      <!-- Footer -->
      <!-- <div class="position-relative text-center zi-1">
        <small class="text-cap text-body mb-4">Trusted by the world's best teams</small>

        <div class="w-85 mx-auto">
          <div class="row justify-content-between">
            <div class="col">
              <img class="img-fluid" src="./assets/svg/brands/gitlab-gray.svg" alt="Logo">
            </div>

            <div class="col">
              <img class="img-fluid" src="./assets/svg/brands/fitbit-gray.svg" alt="Logo">
            </div>

            <div class="col">
              <img class="img-fluid" src="./assets/svg/brands/flow-xo-gray.svg" alt="Logo">
            </div>

            <div class="col">
              <img class="img-fluid" src="./assets/svg/brands/layar-gray.svg" alt="Logo">
            </div>
          </div>
        </div>
      </div> -->
      <!-- End Footer -->
    </div>
  </div>
  <!-- End Content -->
</main>

<script type="text/javascript">
  var dom;
  var url;
  var serverApiURL;
  var providerDetails = {}
  var redirectIsValid = false;
  var redirectUrl;
  var qsToken;

  Manager.auth().ready(function () {
    dom = Manager.dom();
    var user = firebase.auth().currentUser;
    url = new URL(window.location.href);
    var action = false;
    // var serverApiURL = Manager.properties.meta.environment === 'development'
    serverApiURL = url.searchParams.get('development')
      ? 'http://localhost:5001/PROJECT_ID/us-central1/bm_api'
      : 'https://us-central1-PROJECT_ID.cloudfunctions.net/bm_api'

    redirectUrl = decodeURIComponent(url.searchParams.get('destination') || 'https://music.soundgrail.com');
    qsToken = decodeURIComponent(url.searchParams.get('token') || '');
    // console.log('--redirectUrl', redirectUrl);
    serverApiURL = serverApiURL.replace(/PROJECT_ID/g, Manager.properties.options.libraries.firebase_app.config.projectId)
    redirectIsValid = Manager.isValidRedirectUrl(redirectUrl)

    // console.log('---redirect', redirectIsValid, redirectUrl);

    firebase.auth()
      .getRedirectResult()
      .then(function (result) {
        console.log('----result', result);
        display();
        if (!action) {
          display('hidden');
          if (url.searchParams.get('signout')) {
            console.log('----SIGNOUT');
            action = true;
            firebase.auth().signOut()
            .catch(function (e) {
              console.error('Error signing out', e);
              display(e);
            })
            .finally(function () {
              url.searchParams.delete('signout')
              redirect(url.toString())
            })
          } else {
            // console.log('----qsToken', qsToken);
            // qsToken can be set on its own to simply sign in with it
            if (qsToken) {
              console.log('signInWithCustomToken(qsToken)', qsToken);
              firebase.auth().signInWithCustomToken(qsToken)
              .then(function (r) {
                redirect(redirectUrl)
              })
              .catch(function (e) {
                display(e);
              })
            } else if (result && result.user) {
              createCustomToken({user: result.user})
            } else {
              action = true;
              console.log('----READY');
              var prodiver = url.searchParams.get('provider');
              if (prodiver) {
                firebase.auth().signInWithRedirect(new firebase.auth.OAuthProvider(provider))
                .catch(function (e) {
                  display(e);
                })
              } else {

                // Get provider details
                fetch(serverApiURL, {
                  method: 'POST',
                  headers: { 'Content-Type': 'application/json' },
                  body: JSON.stringify({
                    command: 'firebase:get-providers',
                    payload: {
                      firebaseApiKey: Manager.properties.options.libraries.firebase_app.config.apiKey,
                    },
                  }),
                })
                .then(function (res) { // This function runs only on success
                  if (res.ok) {
                    res.json()
                    .then(function (data) {
                      var providerCount = 0;
                      providerDetails = data;

                      Object.values(providerDetails)
                      .forEach((value, i) => {
                        providerCount += value ? 1 : 0;
                      });

                      if (providerCount < 1) {
                        document.getElementById('auth-provider-buttons').setAttribute('hidden', true)
                      }

                      firebase.auth().onAuthStateChanged(function (user) {
                        if (user) {
                          display('hidden');
                          createCustomToken({user: user})
                        }
                      })
                      display('waiting')
                    })
                  } else {
                    return res.text()
                    .then(function (data) {
                      throw new Error(data || res.statusText || 'Unknown error.')
                    })
                  }
                })
                .catch(function (e) { // This function runs only on error
                  console.error('Fail', e);
                  display(e);
                })

              }
            }
          }
        }
      })
      .catch(function (e) {
        console.error('----e', e);
        display(e);
      });



    console.log('----FIRST', url.toString());
    console.log('----user', user);




    /*
      firebase.auth().signInWithRedirect(new firebase.auth.OAuthProvider('google.com'))
      http://localhost:4000/authentication/oauth/?provider=google.com&signout=true&development=true
    */

    document.addEventListener('click', function (event) {
      if (event.target.matches('#relaunch-btn')) {
        display('hidden');
        launch();
      }
    })


  })

  function signUpHandler(token) {
    return new Promise(function(resolve, reject) {
      setTimeout(function () {
        return resolve();
      }, 3000);
      if (url.searchParams.get('isSignup') !== 'true') {
        return resolve();
      }
      fetch(serverApiURL, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({
          authenticationToken: token,
          command: 'user:sign-up',
          payload: {
            newsletterSignUp: url.searchParams.get('newsletter') === 'true',
            affiliateCode: url.searchParams.get('affiliateCode'),
          }
        }),
      })
      .catch(function (e) {
        console.log('Fail', e);
      })
      .finally(function () {
        return resolve();
      })
    });
  }

  function redirect(url) {
    console.log('Redirecting to', url);
    window.location.href = url;
  }

  function launch() {
    // if (url.searchParams.get('inApp') === 'true' && window.electronManager) {
    if (window.electronManager) {
      window.electronManager().processCustomToken(window.tokenResult);
    } else {
      // console.log('--window.tokenResult', window.tokenResult);
      redirectUrl = new URL(redirectUrl);
      redirectUrl.searchParams.set('payload', JSON.stringify({
        token: window.tokenResult
      }))
      redirectUrl = redirectUrl.toString();

      if (!redirectIsValid) {
        var invalidError = new Error('This URL is not valid: ' + redirectUrl)
        if (Manager.properties.meta.environment === 'development') {
          console.error(invalidError);
        } else {
          display(invalidError)
          return
        }
      }

      setTimeout(function () {
        display('success', 'Success! Please allow this webpage to open the SoundGrail app. <br><br> After you are logged in, you can close this tab.')
      }, 1000);
      // console.log('----redirectUrl', redirectUrl);
      // window.location.href = 'somiibo://dashboard?signin-with-token=true&token=' + window.tokenResult;
      redirect(redirectUrl)
    }
  }

  function createCustomToken(payload) {
    console.log('---createCustomToken', payload);
    payload.user.getIdToken(false)
    .then(function (token) {
      console.log('---token', token);
      signUpHandler(token)
      .then(function () {
        fetch(serverApiURL, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({
            command: 'user:create-custom-token',
            authenticationToken: token,
          }),
        })
        .then(function (res) { // This function runs only on success
          if (res.status >= 200 && res.status < 300) {
            res.json()
            .then(function (data) {
              console.log('Custom token', data.token);
              window.tokenResult = data.token;
              launch();
            })
          } else {
            return res.text()
            .then(function (data) {
              throw new Error(data || res.statusText || 'Unknown error.')
            })
          }
        })
        .catch(function (e) { // This function runs only on error
          console.error('Fail', e);
          display(e);
        })
      })
    })
  }
  window.createCustomToken = createCustomToken;

  function display(type, msg) {
    var alertEl = dom.select('#result')
    var spinnerEl = dom.select('#spinner')
    var resendBtn = dom.select('#relaunch-btn')
    var authContainer = dom.select('#auth-container')
    var providerBtnEl = dom.select('a[data-provider]')
    var emailAndPassForm = dom.select('#email-and-password-form')
    var authOrSeparatorEl = dom.select('#auth-or-separator')

    console.log('display()', type, msg);

    alertEl
      .setAttribute('hidden', true)
      .removeClass('alert-danger')
      .removeClass('alert-success')
    spinnerEl
      .removeAttribute('hidden')
    resendBtn
      .setAttribute('hidden', true)
    authContainer
      .removeAttribute('hidden')

    if (type && type !== 'hidden') {
      alertEl.removeAttribute('hidden')
    }

    providerBtnEl
      .setAttribute('hidden', true)
      .setAttribute('disabled', true)
      .removeClass('disabled')

    emailAndPassForm
      .setAttribute('hidden', true)
      .setAttribute('disabled', true)
      .removeClass('disabled')

    authOrSeparatorEl
      .setAttribute('hidden', true)

    if (type === 'waiting') {
      spinnerEl
        .setAttribute('hidden', true)

      providerBtnEl
      .each(function (el) {
        var provider = el.dataset.provider;
        // console.log('===provider', provider, providerDetails[provider]);
        if (providerDetails[provider]) {
          el.removeAttribute('hidden');
          el.removeAttribute('disabled');
          el.classList.remove('disabled');
        } else {
          el.setAttribute('hidden', true);
          el.setAttribute('disabled', true);
          el.classList.add('disabled');
        }
      })

      emailAndPassForm
        .removeAttribute('hidden')
        .removeAttribute('disabled')
        .removeClass('disabled')

      authOrSeparatorEl
        .removeAttribute('hidden');

      alertEl
        .setAttribute('hidden', true)

    } else if (type instanceof Error) {
      alertEl
        .addClass('alert-danger')
        .setInnerHTML('Failed to sign you in. Please try again: <br><br>' + type)
      spinnerEl
        .setAttribute('hidden', true)
      // console.error(type);
    } else if (type === 'success' || type === 'hidden') {
      if (type === 'success') {
        alertEl
          .addClass('alert-success')
          .setInnerHTML(msg || 'Success! Redirecting you...')
        spinnerEl
          .setAttribute('hidden', true)
        resendBtn
          .removeAttribute('hidden')
      }

      authContainer
        .setAttribute('hidden', true)
    }
  }

</script>

    <!-- CONTENT END -->
    <!-- Master - Alert Box -->
<div class="master-alert master-alert-outdated">
  <span class="master-alert-close" onclick="this.parentElement.style.display='none';">&times;</span>
  You are using an outdated browser that our site <strong>DOES NOT</strong> support. Please <a href="https://www.google.com/chrome/" rel="nofollow" target="_blank">click here</a> to update your browser.
</div>

<!-- Master - Chat Opener -->
<a href="#" onclick="return false;" id="prechat-btn" style="display: none;">
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512">
    <path fill="#ffffff" d="M448 0H64C28.7 0 0 28.7 0 64v288c0 35.3 28.7 64 64 64h96v84c0 7.1 5.8 12 12 12 2.4 0 4.9-.7 7.1-2.4L304 416h144c35.3 0 64-28.7 64-64V64c0-35.3-28.7-64-64-64zm16 352c0 8.8-7.2 16-16 16H288l-12.8 9.6L208 428v-60H64c-8.8 0-16-7.2-16-16V64c0-8.8 7.2-16 16-16h384c8.8 0 16 7.2 16 16v288z"/>
  </svg>
</a>

<!-- Performance -->
<script type="text/javascript">
  try {
    window.performance.mark('manager_preBundle');
  } catch (e) {}
</script>

<!-- App - Foot Content (pre-bundle) -->
  <!-- App Foot Content (pre-bundle) -->


<!-- Script - Bundle -->


<!-- TODO: FIX THIS -->

<!-- Theme  --><script>
	window.hs_config = {
		"autopath": "@@autopath",
		"deleteLine": "hs-builder:delete",
		"deleteLine:build": "hs-builder:build-delete",
		"deleteLine:dist": "hs-builder:dist-delete",
		"previewMode": false,
		"startPath": "/index.html",
		"vars": {
			"themeFont": "https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap",
			"version": "?v=1.0"
		},
		"layoutBuilder": {
			"extend": {
				"switcherSupport": true
			},
			"header": {
				"layoutMode": "default",
				"containerMode": "container-fluid"
			},
			"sidebarLayout": "default"
		},
		"themeAppearance": {
			"layoutSkin": "default",
			"sidebarSkin": "default",
			"styles": {
				"colors": {
					"primary": "#377dff",
					"transparent": "transparent",
					"white": "#fff",
					"dark": "132144",
					"gray": {
						"100": "#f9fafc",
						"900": "#1e2022"
					}
				},
				"font": "Inter"
			}
		},
		"languageDirection": {
			"lang": "en"
		},
		"skipFilesFromBundle": {
			"dist": ["assets/js/hs.theme-appearance.js", "assets/js/hs.theme-appearance-charts.js", "assets/js/demo.js"],
			"build": ["assets/css/theme.css", "assets/vendor/hs-navbar-vertical-aside/dist/hs-navbar-vertical-aside-mini-cache.js", "assets/js/demo.js", "assets/css/theme-dark.css", "assets/css/docs.css", "assets/vendor/icon-set/style.css",
				"assets/js/hs.theme-appearance.js", "assets/js/hs.theme-appearance-charts.js", "node_modules/chartjs-plugin-datalabels/dist/chartjs-plugin-datalabels.min.js", "assets/js/demo.js"
			]
		},
		"minifyCSSFiles": ["assets/css/theme.css", "assets/css/theme-dark.css"],
		"copyDependencies": {
			"dist": {
				"*assets/js/theme-custom.js": ""
			},
			"build": {
				"*assets/js/theme-custom.js": "",
				"node_modules/bootstrap-icons/font/*fonts/**": "assets/css"
			}
		},
		"buildFolder": "",
		"replacePathsToCDN": {},
		"directoryNames": {
			"src": "./src",
			"dist": "./dist",
			"build": "./build"
		},
		"fileNames": {
			"dist": {
				"js": "theme.min.js",
				"css": "theme.min.css"
			},
			"build": {
				"css": "theme.min.css",
				"js": "theme.min.js",
				"vendorCSS": "vendor.min.css",
				"vendorJS": "vendor.min.js"
			}
		},
		"fileTypes": "jpg|png|svg|mp4|webm|ogv|json"
	}
	window.hs_config.gulpRGBA = (p1) => {
		var options = p1.split(',')
		var hex = options[0].toString()
		var transparent = options[1].toString()

		var c;
		if (/^#([A-Fa-f0-9]{3}){1,2}$/.test(hex)) {
			c = hex.substring(1).split('');
			if (c.length == 3) {
				c = [c[0], c[0], c[1], c[1], c[2], c[2]];
			}
			c = '0x' + c.join('');
			return 'rgba(' + [(c >> 16) & 255, (c >> 8) & 255, c & 255].join(',') + ',' + transparent + ')';
		}
		throw new Error('Bad Hex');
	}
	window.hs_config.gulpDarken = (p1) => {
		var options = p1.split(',')

		var col = options[0].toString()
		var amt = -parseInt(options[1])
		var usePound = false

		if (col[0] == "#") {
			col = col.slice(1)
			usePound = true
		}
		var num = parseInt(col, 16)
		var r = (num >> 16) + amt
		if (r > 255) {
			r = 255
		} else if (r < 0) {
			r = 0
		}
		var b = ((num >> 8) & 0x00FF) + amt
		if (b > 255) {
			b = 255
		} else if (b < 0) {
			b = 0
		}
		var g = (num & 0x0000FF) + amt
		if (g > 255) {
			g = 255
		} else if (g < 0) {
			g = 0
		}
		return (usePound ? "#" : "") + (g | (b << 8) | (r << 16)).toString(16)
	}
	window.hs_config.gulpLighten = (p1) => {
		var options = p1.split(',')

		var col = options[0].toString()
		var amt = parseInt(options[1])
		var usePound = false

		if (col[0] == "#") {
			col = col.slice(1)
			usePound = true
		}
		var num = parseInt(col, 16)
		var r = (num >> 16) + amt
		if (r > 255) {
			r = 255
		} else if (r < 0) {
			r = 0
		}
		var b = ((num >> 8) & 0x00FF) + amt
		if (b > 255) {
			b = 255
		} else if (b < 0) {
			b = 0
		}
		var g = (num & 0x0000FF) + amt
		if (g > 255) {
			g = 255
		} else if (g < 0) {
			g = 0
		}
		return (usePound ? "#" : "") + (g | (b << 8) | (r << 16)).toString(16)
	}
</script>

<script src="https://cdn.itwcreativeworks.com/assets/ultimate-jekyll/vendor/front-admin/v2/js/hs.theme-appearance.js" charset="utf-8"></script>
<!-- JS Global Compulsory  --> <script src="https://cdn.itwcreativeworks.com/assets/ultimate-jekyll/vendor/front-admin/v2/vendor/jquery/dist/jquery.min.js"></script> <script src="https://cdn.itwcreativeworks.com/assets/ultimate-jekyll/vendor/front-admin/v2/vendor/jquery-migrate/dist/jquery-migrate.min.js"></script> <script src="https://cdn.itwcreativeworks.com/assets/ultimate-jekyll/vendor/front-admin/v2/vendor/bootstrap/dist/js/bootstrap.bundle.min.js"></script>
<!-- JS Implementing Plugins --> <script src="https://cdn.itwcreativeworks.com/assets/ultimate-jekyll/vendor/front-admin/v2/vendor/hs-toggle-password/dist/js/hs-toggle-password.js"></script>
<!-- JS Front --> <script src="https://cdn.itwcreativeworks.com/assets/ultimate-jekyll/vendor/front-admin/v2/js/theme.min.js"></script>
<!-- ITW CW --> <script type="text/javascript" src="/assets/js/master.js?cb=1659317455" async defer></script><style media="screen">
  body[data-theme="dark"] #main-logo {
    filter: brightness(0) invert(1);
  }
</style>

<script type="text/javascript">
  // https://stackoverflow.com/questions/326069/how-to-identify-if-a-webpage-is-being-loaded-inside-an-iframe-or-directly-into-t
  var inIframe = false;
  try {
    inIframe = window.self !== window.top;
  } catch (e) {
    inIframe = true;
  }

  if (inIframe) {
    function _sendParentMessage(message) {
      window.parent.postMessage(message, '*')
    }

    function messageHandler() {
      var message = event.data || {};
      var command = message.command || '';
      var payload = message.payload || {};

      console.log('Message', command, payload.type, message);

      if (command === 'embed-manager:update') {
        if (payload.type === 'theme-change') {
          setTheme(payload.theme)
        }
      }
    }

    function setTheme(theme) {
      try {
        theme = theme || HSThemeAppearance.getAppearance();
        HSThemeAppearance.setAppearance(theme)
        document.body.setAttribute('data-theme', theme);
      } catch (e) {
        console.error('Cannot set appearance', e);
      }
    }

    setTheme();

    window.addEventListener('message', messageHandler, false);

    // Fetch build.json
    fetch('https://music.soundgrail.com/@output/build/build.json?cb=' + new Date().getTime(), {
      method: 'GET',
    })
    .then(function (res) {
      if (res.ok) {
        res.json()
        .then(function (data) {
          _sendParentMessage({
            command: 'embed-manager:update',
            payload: {
              type: 'init',
              url: window.location.href,
              build: data,
            },
          })
        })
      } else {
        return res.text()
        .then(function (data) {
          throw new Error(data || res.statusText || 'Unknown error.')
        })
      }
    })
    .catch(function (e) {
      var error = new Error('Failed to fetch build.json: ' + e)
      console.error(error);
      alert(error)
    })

    // Fetch auth
    Manager.auth().ready(function () {
      var user = firebase.auth().currentUser || {};
      _sendParentMessage({
        command: 'embed-manager:update',
        payload: {
          type: 'auth',
          user: {
            authenticated: !!user.uid,
            uid: user.uid,
            email: user.email,
          },

        }
      })
    })

  }
</script>



<!-- Script - Google Analytics Tracking Script -->
  <script type="text/javascript" src="https://www.googletagmanager.com/gtag/js?id=UA-114924895-3" async></script>
  <script type="text/javascript" async>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-114924895-3');
  </script>


<!-- Script - Facebook Pixel Tracking Script -->


<!-- Script - TikTok Pixel Tracking Script -->


<!-- Script - Social Share Kit Script -->


<!-- Script - Google Adsense -->
  
  <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-7372939085773564" crossorigin="anonymous"></script>


<!-- Schema - Breadcrumbs -->
  

  <script id="uj-breadcrumbs-json" type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "BreadcrumbList",
      "itemListElement": [
        {
          "@type": "ListItem",
          "position": 1,
          "name": "Home",
          "item": "https://music.soundgrail.com"
        }
                  
                  
                  ,{
                    "@type": "ListItem",
                    "position": 3,
                    "name": "Token"
                    
                  }]
    }
  </script>


<!-- Schema - Brand -->
  <script id="uj-brand-json" type="application/ld+json">
  {
    "@context": "http://schema.org",
    "@type": "Corporation",
    "name": "SoundGrail",
    "description": "SoundGrail is a free music theory app for pianists, guitarists and DJs. Learn chords, scales, key signatures, and more. Play guitar, piano and DJ like a pro!.",
    "logo": "https://cdn.itwcreativeworks.com/assets/soundgrail/images/logo/soundgrail-brandmark-black-3000x3000.png",
    "url": "https://music.soundgrail.com",
    "sameAs": ["https://www.linkedin.com/company/","https://www.youtube.com/channel/","https://twitter.com/soundgrailmusic","https://www.instagram.com/soundgrail/","https://.tumblr.com/","https://www.facebook.com/soundgrail/",""
    ],
    "address": {
      "@type": "PostalAddress",
      "addressLocality": "Los Angeles",
      "addressCountry": "United States"
    }
  }
  </script>


<!-- Schema - Sitelinks -->
  <script id="uj-sitelinks-json" type="application/ld+json">
    {
      "@context": "http://schema.org",
      "@type": "WebSite",
      "url": "https://music.soundgrail.com",
      "potentialAction": {
        "@type": "SearchAction",
        "target": "https://music.soundgrail.com/search/cse?q={search_term_string}",
        "query-input": "required name=search_term_string"
      }
    }
  </script>


<!-- App - Foot Content -->


<!-- Page - Injected head -->


</body>
</html>
